// Generated by CoffeeScript 1.6.3
(function() {
  $(function() {
    var $go, $search, AllMaps, AllMapsView;
    window.views = {};
    AllMaps = window.AllMaps;
    window.views.MapItem = Backbone.View.extend({
      tagName: 'section',
      template: $("#map-instance").html(),
      initialize: function() {
        _.bindAll(this, "render");
        return this.model.instance = this;
      },
      render: function() {
        this.$el.html(_.template(this.template, this.model.toJSON()));
        cc(this.$el.html());
        return this;
      },
      afterAppend: function() {
        this.model.set("map", new window.GoogleMap(this.model));
        return this.$(".timeline-slider").slider();
      },
      events: {
        "click .go": function() {
          var start, _i, _results;
          cc(this.model);
          _results = [];
          for (start = _i = 0; _i <= 12; start = _i += 4) {
            cc(start);
            _results.push(this.model.getGoogleNews(this.$(".news-search").val(), start));
          }
          return _results;
        },
        "click [data-route]": function(e) {
          var $t, current_route, route;
          $t = $(e.currentTarget);
          route = $t.data("route");
          current_route = Backbone.history.fragment;
          return window.app.navigate(route, {
            trigger: true
          });
        }
      }
    });
    window.views.MapInstanceList = Backbone.View.extend({
      el: ".map-instance-list",
      initialize: function() {
        this.listenTo(this.collection, {
          add: this.addInstance
        });
        return this;
      },
      addInstance: function(model) {
        var instance, item;
        item = new window.views.MapItem({
          model: model
        });
        instance = $(item.render().el);
        instance.appendTo(this.$el);
        item.afterAppend();
        instance.siblings().hide();
        return this;
      }
    });
    AllMapsView = new window.views.MapInstanceList({
      collection: AllMaps
    });
    $search = $("#news-search");
    $go = $("#go");
    $search.focus().on("keydown", function(e) {
      if (e.keyCode === 13 || e.which === 13) {
        $go.trigger("click");
        return;
      }
      return $(this).data("start_index", $(this).data("start_index") + 1);
    });
    return window.app.navigate("/map/0", true);
  });

}).call(this);
